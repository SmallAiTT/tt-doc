## 工作交接


## cocos2d-html5引擎代码

相关的模块的文档我都有编写。
引擎代码的交接应该比较不成问题，需要的话，可能到时就是讲下为何如此设计而已。

## cocos-utils

这部分现在是跟着cocos2d-html5的npm分支。

交接工作主要设计到的是现有插件的维护和新插件的开发。

这部分如果有需要，我可以提供下新增插件的操作文档。

现在已经在做cocos-console了，3.0现有的设计，也可以很好的支持模块拆分了，所以，建议3.0不要有npm分支。
也就是说，cocos-utils只做为对2.0的npm分支的支持，而且应该在官网上表明说今后可能不在维护。
这是因为，现在与cocos-console一样，都用"cocos"命令，这样，如果两个都装了，就会出现命令重了的问题。

现在，我在引擎的tools里面放了自动publish的nodejs脚本，并写了十分详细的中文注释，一并给了cocos-console组了。

cocos-utils今后建议提取出来的一个功能，建议是genRes这个，看看能不能集成到cocos-console中去。
这个功能在项目开发中还是很有用的，可以让开发者省去编写资源文件路径的麻烦。


## 移动支付

* 移动支付的接口文档
* 疯狂椰子的服务端代码（java）



## 近段时间对引擎源码提出的建议：

1). 关于混淆

    * 尽量去除关键值，例如this，可以使用var self = this来替换。
    * extend的时候，属性赋值如果是普通类型的，不要再ctor里面在进行一次，例如：

    ```
    cc.MyLayer = cc.Layer.extend({
        _x : 0,
        _y : 0,

        obj : null,

        ctor : function(){
            this._super();
            this.obj = new SomeObj();
        }
    });
    ```

    * 内部使用的true/flase可以用1/0代替，但是这样会导致代码难以阅读，真的还需要再压缩时才考虑

2). 关于日志

    * 因为直接没有区分cc.warn和cc.error，统一都是cc.log，这样会导致开发者看后台输出时漏掉一些关键信息，需要改成对应的cc.warn或者cc.error
    * 打印的字符串更是影响压缩率的一大因素，需要单独抽出。


## 123G技术支持总结：

1). 内存泄露情况调试麻烦：

    在调试工具中，所有的对象的类都是Class，没法区分出到底具体是什么类。建议加上个开关项可以打开之前王劲加的那个Class功能。

2). plist文件支持不够友好。

    这点在v3.0中已经可以轻松实现用户自定义配置文件了。在文档中，我也写了个例子，用于将多个plist文件内容整合到一个json文件中进行处理。

3). ccbi解析卡顿：

    这点我前阵子重构代码的时候，有稍微看了下，我认为原因有以下几点：

    * 在h5中，解析ccbi这种二进制文件，还不如直接解析一个json来得高效；
    * 在引擎中，实现了一种“延迟加载”的机制，也就是说，我只preload一个`root.ccbi`，`root.ccbi`中包含的`child1.ccbi`等等都不用preload，
      会在运行中动态的去进行延迟加载。
      但是这其中却有一个非常大的坑，那就是每次这么加载，都是用同步的方式去加载这些ccbi，因此会发现，创建ccbi对象的时候老是非常卡。
      这种卡顿现象与延迟加载现象完全不一样，可以很明显的感知出来。
      所以建议引擎中，应该进行重构，尽量去掉这种同步加载的方式。

3). 混淆打包麻烦，而且坑比较多。
    这点现在的脚本已经很好的支持了，而且通过华彬找文档，用expose注释之后，方便了很多，也规范了很多。


## 个人建议

1). Test Case必须重写。
    * v3.0api已经改了，而且现在jsb已经归h5这边管了，所以现在测试例应该以h5的使用习惯为主，而不再是必须保持跟-x里面的测试例一样。
    * 让每个测试例变得更加单纯和清晰，可以做成像类似于npm分支的那样最好。

2). debugNode只是个噱头，我个人认为，这段时间还是应该把精力放在引擎的易用性、友好性、稳定性以及效率上，包括jsb。所以应该让智明投入到这方面的工作中，而不是debugNode。


3). 应该定期的审核、重构下引擎的代码。之前是为了保持跟-x一样，所以里面的一些代码也是搬过来。现在回过头来看一看，肯定会发现有很多代码需要重构的，例如这次的cc.loader、cc.path等就是这样。
    ps: cocostudio这部分的估计就不要去重构了，因为cocostudio本身还不稳定，坑也比较多，还是跟他们的-x版的代码保持一致，要不工作量和维护成本都太大了。